Listen 80

ServerSignature Off
ServerTokens Prod
TraceEnable off

<VirtualHost *:{{ horizon_port }}>
    LogLevel warn
    ErrorLog /var/log/kolla/horizon/horizon.log
    LogFormat "%{X-Forwarded-For}i %l %u %t \"%r\" %>s %b %D \"%{Referer}i\" \"%{User-Agent}i\"" logformat
    CustomLog /var/log/kolla/horizon/horizon-access.log logformat

    WSGIScriptReloading On
    WSGIDaemonProcess horizon-http processes=1 threads=1 user=horizon group=horizon display-name=%{GROUP} python-path={{ container_python_path }}
    WSGIProcessGroup horizon-http
    WSGIScriptAlias / {{ container_python_path }}/openstack_dashboard/wsgi/django.wsgi
    WSGIPassAuthorization On
    WSGIApplicationGroup %{GLOBAL}

    <Location "/">
        Require all granted
    </Location>

    Alias /static {{ container_python_path }}/static
    <Location "/static">
        SetHandler None
    </Location>
</VirtualHost>

Header edit Location ^http://(.*)$ https://$1

{% if horizon_webroot %}
# Transparently pass-through WEBROOT
RewriteEngine on
RewriteRule "^{{ horizon_webroot }}(.+)" "/$1" [PT]
{% endif %}

<IfModule mod_expires.c>
    <Filesmatch "\.(jpg|jpeg|png|gif|js|css|swf|ico|woff)$">
        ExpiresActive on
        ExpiresDefault "access plus 1 month"
        ExpiresByType application/javascript "access plus 1 year"
        ExpiresByType text/css "access plus 1 year"
        ExpiresByType image/x-ico "access plus 1 year"
        ExpiresByType image/jpg "access plus 1 year"
        ExpiresByType image/jpeg "access plus 1 year"
        ExpiresByType image/gif "access plus 1 year"
        ExpiresByType image/png "access plus 1 year"
        Header merge Cache-Control public
        Header unset ETag
    </Filesmatch>
</IfModule>
